import{S as L,b,T as f,a as _,R as w,m as i,L as T}from"./BktpiT-y.js";class p extends L{constructor(){super(...arguments),Object.defineProperty(this,"itemContainers",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new b(f.new({}),()=>_._new(this._root,{themeTags:i(this.itemContainers.template.get("themeTags",[]),["legend","item"]),themeTagsSelf:i(this.itemContainers.template.get("themeTagsSelf",[]),["itemcontainer"]),background:w.new(this._root,{themeTags:i(this.itemContainers.template.get("themeTags",[]),["legend","item","background"]),themeTagsSelf:i(this.itemContainers.template.get("themeTagsSelf",[]),["itemcontainer"])})},[this.itemContainers.template])))}),Object.defineProperty(this,"markers",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new b(f.new({}),()=>_._new(this._root,{themeTags:i(this.markers.template.get("themeTags",[]),["legend","marker"])},[this.markers.template])))}),Object.defineProperty(this,"labels",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new b(f.new({}),()=>T._new(this._root,{themeTags:i(this.labels.template.get("themeTags",[]),["legend","label"])},[this.labels.template])))}),Object.defineProperty(this,"valueLabels",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new b(f.new({}),()=>T._new(this._root,{themeTags:i(this.valueLabels.template.get("themeTags",[]),["legend","label","value"])},[this.valueLabels.template])))}),Object.defineProperty(this,"markerRectangles",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(new b(f.new({}),()=>w._new(this._root,{themeTags:i(this.markerRectangles.template.get("themeTags",[]),["legend","marker","rectangle"])},[this.markerRectangles.template])))})}_afterNew(){this._settings.themeTags=i(this._settings.themeTags,["legend"]),this.fields.push("name","stroke","fill"),super._afterNew()}makeItemContainer(e){const t=this.children.push(this.itemContainers.make());return t._setDataItem(e),this.itemContainers.push(t),t.states.create("disabled",{}),t}makeMarker(){const e=this.markers.make();return this.markers.push(e),e.states.create("disabled",{}),e}makeLabel(){const e=this.labels.make();return e.states.create("disabled",{}),e}makeValueLabel(){const e=this.valueLabels.make();return e.states.create("disabled",{}),e}makeMarkerRectangle(){const e=this.markerRectangles.make();return e.states.create("disabled",{}),e}processDataItem(e){super.processDataItem(e);const t=this.makeItemContainer(e),n=this.get("nameField"),a=this.get("fillField"),o=this.get("strokeField");if(t){const u=this.get("clickTarget","itemContainer"),s=e.dataContext;s&&s.set&&s.set("legendDataItem",e),t._setDataItem(e),e.set("itemContainer",t);const m=this.makeMarker();if(m){t.children.push(m),m._setDataItem(e),e.set("marker",m);const r=this.get("useDefaultMarker"),c=m.children.push(this.makeMarkerRectangle());let g=e.get("fill"),l=e.get("stroke");e.set("markerRectangle",c),s&&s.get&&(g=s.get(a,g),l=s.get(o,l)),l||(l=g),r?s.on&&(s.on(a,()=>{c.set("fill",s.get(a))}),s.on(o,()=>{c.set("stroke",s.get(o))})):s&&s.createLegendMarker&&s.createLegendMarker(),c.setAll({fill:g,stroke:l});const d=s.component;d&&d.updateLegendMarker&&d.updateLegendMarker(s)}const h=this.makeLabel();if(h){t.children.push(h),h._setDataItem(e),e.set("label",h),h.text.on("text",()=>{t.setRaw("ariaLabel",h.text._getText()+(this.get("clickTarget")!=="none"?"; "+this._t("Press ENTER to toggle"):"")),t.markDirtyAccessibility()}),s&&s.get&&e.set("name",s.get(n));let r=e.get("name");r&&h.set("text",r)}const k=this.makeValueLabel();if(k&&(t.children.push(k),k._setDataItem(e),e.set("valueLabel",k)),s&&s.show&&(s.on("visible",r=>{t.set("disabled",!r)}),s.get("visible")||t.set("disabled",!0),u!="none")){let r=t;u=="marker"&&(r=m),this._addClickEvents(r,s,e)}this.children.values.sort((r,c)=>{const g=r.dataItem.dataContext,l=c.dataItem.dataContext;if(g&&l){const d=this.data.indexOf(g),v=this.data.indexOf(l);if(d>v)return 1;if(d<v)return-1}return 0}),s&&s.updateLegendValue&&s.updateLegendValue()}}_addClickEvents(e,t,n){e.set("cursorOverStyle","pointer"),e.events.on("pointerover",()=>{const a=t.component;a&&a.hoverDataItem&&a.hoverDataItem(t)}),e.events.on("pointerout",()=>{const a=t.component;a&&a.hoverDataItem&&a.unhoverDataItem(t)}),e.events.on("click",()=>{const a=n.get("label").text._getText();t.show&&t.isHidden&&(t.isHidden()||t.get("visible")===!1)?(t.show(),e.set("disabled",!1),this._root.readerAlert(this._t("%1 shown",this._root.locale,a))):t.hide&&(t.hide(),e.set("disabled",!0),this._root.readerAlert(this._t("%1 hidden",this._root.locale,a)))})}disposeDataItem(e){super.disposeDataItem(e);const t=e.dataContext;t&&t.get&&t.get("legendDataItem")==e&&t.set("legendDataItem",void 0);let n=e.get("itemContainer");n&&(this.itemContainers.removeValue(n),n.dispose());let a=e.get("marker");a&&(this.markers.removeValue(a),a.dispose());let o=e.get("markerRectangle");o&&(this.markerRectangles.removeValue(o),o.dispose());let u=e.get("label");u&&(this.labels.removeValue(u),u.dispose());let s=e.get("valueLabel");s&&(this.valueLabels.removeValue(s),s.dispose())}}Object.defineProperty(p,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Legend"});Object.defineProperty(p,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:L.classNames.concat([p.className])});export{p as L};
